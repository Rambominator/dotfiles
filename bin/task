#!/usr/bin/env ruby
#encoding: utf-8
require 'thor'

HOSTS = '/tmp/hosts'

@@fun_domains = %q{
youtube.com 
lenta.ru 
twitter.com
news2.ru
reader.google.com
championat.ru
market.yandex.ru
ebay.com
dirty.com
}

class Linux < Thor

  desc "hardmod", "enable hardmod"
  def hardmod
    system("cp /etc/hosts #{HOSTS}")
    hosts = File.open(HOSTS,'r+')
    if hosts.grep(/Hard Mod/).empty?
      hosts << "#### Hard Mod ####\n"
      @@fun_domains.split.each {|v| hosts << "127.0.0.1       #{v}\n"}
    else
      puts "Too hard man, you already in hard mod!"
      exit 0
    end
    hosts.close
    copy_to_hosts
    puts "Good luck with hard mod!"
  end

  desc "funmod", "enable funmod"
  def funmod
    system("cp /etc/hosts #{HOSTS}")
    original_hosts = ""
    hosts = File.open(HOSTS,'r')
    line = hosts.readline
    while line !~ /Hard Mod/ do
      original_hosts << line
      if hosts.eof
        puts "You already in fun mode" 
        hosts.close
        exit 0
      end
      line = hosts.readline
    end
    hosts.close
    hosts = File.open(HOSTS,'w')
    hosts << original_hosts
    hosts.close
    copy_to_hosts
    puts "You in fun mod!"
  end

  no_tasks do
    def copy_to_hosts
      system("sudo cp #{HOSTS} /etc/hosts")
    end
  end

end

Linux.start
